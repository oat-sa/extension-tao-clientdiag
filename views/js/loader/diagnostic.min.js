(function(){"use strict";var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function loadController(){var controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={}}window.require([controllerPath],function(controller){var startController=function startController(){window.started||(window.started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),"complete"===document.readyState&&startController()})};window.require([configUrl],function(){window.loadBundles||(window.loaded={},window.loadBundles=function loadBundles(bundles){bundles=bundles||[],bundles=bundles.concat(window.bundles),bundles=bundles.filter(function(item,index){return item&&bundles.indexOf(item)===index&&!0!==window.loaded[item]}),require(bundles,function(){bundles.forEach(function(item){window.loaded[item]=!0}),loadController()})}),bundle||window.bundles&&window.bundles.length?window.loadBundles([bundle]):loadController()})})(),define("loader/bootstrap",function(){}),define("taoClientDiagnostic/tools/fixedDecimals",[],function(){"use strict";return function fixedDecimals(value,decimals){const shift=Math.pow(10,Math.abs(decimals||1));return Math.round(+value*shift)/shift||0}}),define("taoClientDiagnostic/tools/stats",["lodash","taoClientDiagnostic/tools/fixedDecimals"],function(_,fixedDecimals){"use strict";var _Mathfloor=Math.floor,_Mathmax=Math.max,_Mathmin=Math.min;function valueGetter(name){return"function"==typeof name?name:item=>item&&item[name]||0}return function stats(list,fieldName,decimals){var _Mathceil=Math.ceil,_Mathsqrt=Math.sqrt,_NumberMAX_VALUE=Number.MAX_VALUE;const getValue=valueGetter(fieldName),values=[];let min=_NumberMAX_VALUE,max=0,count=0;const sum=_.reduce(list,(sum,item)=>{if("undefined"!=typeof item){const value=getValue(item);return values.push(value),min=_Mathmin(min,value),max=_Mathmax(max,value),sum+=value,count++,sum}},0),average=sum/(count||1),sum2=values.reduce((sum,value)=>{const diff=value-average;return sum+=diff*diff,sum},0),variance=1<count?_Mathsqrt(sum2/(count-1)):0;values.sort();const middle=count/2,median=(values[_Mathfloor(middle)]+values[_Mathceil(middle)])/2,results={min,max,sum,count,average,median,variance};return decimals&&_.forEach(results,(value,key)=>{results[key]=fixedDecimals(value,decimals)}),results.values=list,results}}),define("taoClientDiagnostic/tools/getConfig",["lodash"],function(_){"use strict";return function getConfig(config,defaults){return _(config||{}).omit(value=>null===value||"undefined"==typeof value).defaults(defaults||{}).value()}}),define("taoClientDiagnostic/tools/getLabels",[],function(){"use strict";var _Mathmax2=Math.max,_Mathmin2=Math.min;return function getLabels(messages,level){return messages=messages||{},Array.isArray(messages)||(messages=[messages]),level=_Mathmin2(_Mathmax2(parseInt(level,10)||0,1),messages.length||1)-1,messages[level]||{}}}),define("taoClientDiagnostic/tools/getStatus",["lodash"],function(_){"use strict";var _Mathmax3=Math.max;return function getStatus(percentage,thresholds,opts){const options=opts||{},testPercentage=_Mathmax3(0,Math.min(100,Math.round(parseInt(percentage,10)||0))),globalPercentage=options.minimumGlobalPercentage?_Mathmax3(testPercentage,options.minimumGlobalPercentage):testPercentage,status={percentage:testPercentage,globalPercentage:globalPercentage,quality:{}};if(thresholds){Array.isArray(thresholds)||(thresholds=[thresholds]);let feedback;const len=thresholds.length;for(let i=0;i<len;i++){const step=thresholds[i];if(step&&(!step.threshold||status.percentage>=step.threshold))feedback=step;else break}feedback&&(status.feedback=_.clone(feedback))}return status}}),define("taoClientDiagnostic/tools/performances/tester",["jquery","lodash","i18n","async","context","helpers","taoClientDiagnostic/tools/stats","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/getStatus"],function($,_,__,async,context,helpers,stats,Loader,Renderer,getConfig,getLabels,getStatus){"use strict";var _Mathabs=Math.abs;function loadItem(data,done){const qtiJsonFile=`${data.url}qti.json`,urlTokens=data.url.split("/"),extension=urlTokens[0],fullpath=require.s.contexts._.config.paths[extension],baseUrl=data.url.replace(extension,fullpath),loader=new Loader,renderer=new Renderer({baseUrl:baseUrl});renderer.getAssetManager&&renderer.getAssetManager().setData("baseUrl",baseUrl),require([`json!${qtiJsonFile}`],function(itemData){loader.loadItemData(itemData,function(item){renderer.load(function(){const start=window.performance.now();item.setRenderer(this);const $container=$("<div>").appendTo("body");$container.append(item.render()),item.postRender(),$container.remove();const end=window.performance.now(),duration=(end-start)/_second,result={id:data.id,url:data.url,duration:duration};done(null,result)},this.getLoadedClasses())})})}const _second=1e3,_defaultTimeout=30000,_defaultOccurrencesCount=10,_defaultSamples=["taoClientDiagnostic/tools/performances/data/sample1/","taoClientDiagnostic/tools/performances/data/sample2/","taoClientDiagnostic/tools/performances/data/sample3/"],_defaults={id:"performances",optimal:.025,threshold:.25},_thresholds=[{threshold:0,message:__("Very slow performances"),type:"error"},{threshold:33,message:__("Average performances"),type:"warning"},{threshold:66,message:__("Good performances"),type:"success"}],_messages=[{title:__("Workstation performances"),status:__("Checking the performances..."),performancesMin:__("Minimum rendering time"),performancesMax:__("Maximum rendering time"),performancesAverage:__("Average rendering time")}],_sampleBaseId="sample";return function performancesTester(config){const initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level);let idx=0;const _samples=_.map(!_.isEmpty(initConfig.samples)&&initConfig.samples||_defaultSamples,sample=>(idx++,{id:_sampleBaseId+idx,url:sample,timeout:1e3*initConfig.timeout||_defaultTimeout,nb:initConfig.occurrences||_defaultOccurrencesCount}));return _samples[0].nb++,{start(done){const tests=[];_.forEach(_samples,data=>{const cb=_.partial(loadItem,data);for(let iterations=data.nb||1;iterations--;)tests.push(cb)}),async.series(tests,(err,measures)=>{const decimals=2;if(err&&!measures.length)throw err;measures.shift();const results=stats(measures,"duration",2),status=this.getFeedback(results.average),summary=this.getSummary(results);done(status,summary,results)})},get labels(){return labels},getSummary(results){return{performancesMin:{message:labels.performancesMin,value:`${results.min} s`},performancesMax:{message:labels.performancesMax,value:`${results.max} s`},performancesAverage:{message:labels.performancesAverage,value:`${results.average} s`}}},getFeedback(result){const optimal=initConfig.optimal,range=_Mathabs(optimal-initConfig.threshold),status=getStatus(100*((range+optimal-result)/range),_thresholds);return status.title=labels.title,status.id=initConfig.id,status}}}}),define("taoClientDiagnostic/tools/bandwidth/tester",["lodash","i18n","async","context","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/stats","taoClientDiagnostic/tools/fixedDecimals","taoClientDiagnostic/tools/getStatus"],function(_,__,async,context,getConfig,getLabels,stats,fixedDecimals,getStatus){"use strict";var _Mathfloor2=Math.floor,_Mathmax4=Math.max;function download(data,cb){if(data.threshold&&this.bandwidth<data.threshold)return cb("threshold");const start=window.performance.now(),url=`${context.root_url}taoClientDiagnostic/views/js/tools/bandwidth/${data.file}?${Date.now()}`,timeoutId=window.setTimeout(cb,data.timeout,"timeout"),request=new XMLHttpRequest;request.open("GET",url,!0),request.setRequestHeader("Accept","application/octet-stream"),request.onload=()=>{const end=window.performance.now();clearTimeout(timeoutId);const duration=end-start,bytes=data.size,seconds=duration/_second,speed=8*bytes/seconds/_mega;return this.bandwidth=_Mathmax4(this.bandwidth,speed),cb(null,{id:data.id,file:data.file,size:data.size,duration,speed})},request.onerror=err=>{clearTimeout(timeoutId),cb(err)},request.onreadystatechange=()=>{4===request.readyState&&200!==request.status&&(clearTimeout(timeoutId),cb(request.status))},request.send()}const _kilo=1024,_mega=1048576,_second=1e3,_thresholds=[{threshold:0,message:__("Low bandwidth"),type:"error"},{threshold:33,message:__("Average bandwidth"),type:"warning"},{threshold:66,message:__("Good bandwidth"),type:"success"}],_defaults={id:"bandwidth",unit:.16,ideal:45,max:100,minimumGlobalPercentage:!1,feedbackThresholds:_thresholds,fallbackThreshold:.2},_downloadData={"10KB":{id:"10KB",file:"data/bin10KB.data",size:10240,timeout:_second,threshold:0,nb:10},"100KB":{id:"100KB",file:"data/bin100KB.data",size:102400,timeout:2*_second,threshold:0,nb:5},"1MB":{id:"1MB",file:"data/bin1MB.data",size:_mega,timeout:20*_second,threshold:0,nb:3}},_messages=[{title:__("Bandwidth"),status:__("Checking the bandwidth..."),legend:__("Number of simultaneous test takers the connection can handle"),bandwidthMin:__("Minimum bandwidth"),bandwidthMax:__("Maximum bandwidth"),bandwidthAverage:__("Average bandwidth")},{title:__("Media intensive bandwidth"),status:__("Checking the media intensive bandwidth..."),legend:__("Number of simultaneous test takers the connection can handle with media intensive"),bandwidthMin:__("Minimum intensive bandwidth"),bandwidthMax:__("Maximum intensive bandwidth"),bandwidthAverage:__("Average intensive bandwidth")}];return function bandwidthTester(config){const initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level);return _.isArray(initConfig.feedbackThresholds)&&!initConfig.feedbackThresholds.length&&(initConfig.feedbackThresholds=_thresholds),{start(done){const tests=[];_.forEach(_downloadData,data=>{const cb=download.bind(this,data);for(let iterations=data.nb||1;iterations--;)tests.push(cb)}),this.bandwidth=0,async.series(tests,(err,measures)=>{function getValue(value){let speed=0;return value&&(duration+=value.duration,size+=value.size,speed=value.speed,value.speed=fixedDecimals(speed,decimals)),speed}let duration=0,size=0;const decimals=2,resultsBySize={};if(err&&!measures.length)throw err;const results=stats(measures,getValue,2);_.forEach(_downloadData,(data,key)=>{resultsBySize[key]=stats(_.filter(measures,o=>o.id===key),getValue,decimals)}),results.duration=fixedDecimals(duration/_second,2),results.size=size;const summary=this.getSummary(results),status=this.getFeedback(results,resultsBySize);done(status,summary,results)})},get labels(){return labels},getSummary(results){return{bandwidthMin:{message:labels.bandwidthMin,value:results.min+" Mbps"},bandwidthMax:{message:labels.bandwidthMax,value:results.max+" Mbps"},bandwidthAverage:{message:labels.bandwidthAverage,value:results.average+" Mbps"}}},getFeedback(result,resultsBySize){const avgResult=result.average,bandwidthUnit=initConfig.unit,threshold=initConfig.ideal,maxTestTakers=initConfig.max,max=threshold*bandwidthUnit,getStatusOptions=initConfig.minimumGlobalPercentage?{minimumGlobalPercentage:initConfig.minimumGlobalPercentage}:{},baseBandwidth=avgResult;let stable=!0;_.forEach(resultsBySize,resultBySize=>{resultBySize.min/resultBySize.average<initConfig.fallbackThreshold&&(stable=!1)});const status=getStatus(100*(baseBandwidth/max),initConfig.feedbackThresholds,getStatusOptions);let nb=_Mathfloor2(baseBandwidth/bandwidthUnit);return nb>maxTestTakers&&(nb=">"+maxTestTakers),status.id=initConfig.id,status.title=labels.title,status.feedback.legend=labels.legend,status.quality.label=nb,stable||(status.feedback.type="warning",status.feedback.message=__("Unstable bandwidth, temporary fluctuations in connection speed may affect test taker experience."),status.feedback.legend=__("Simultaneous test takers under normal connection conditions.")),2<nb.toString().length&&(status.quality.wide=!0),status}}}}),define("taoClientDiagnostic/tools/upload/tester",["jquery","lodash","i18n","async","util/url","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/getStatus"],function($,_,__,async,urlHelper,getConfig,getLabels,getStatus){"use strict";var _Mathround=Math.round;function generateStr(length){let text="";const possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<length;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}function upload(size){const url=urlHelper.route("upload","CompatibilityChecker","taoClientDiagnostic",{cache:Date.now()}),str=generateStr(size);return data=[],$.ajax({url:url,type:"POST",data:{upload:str},xhr:()=>{const xhr=new window.XMLHttpRequest,startTime=Date.now();return xhr.upload.addEventListener("progress",evt=>{if(evt.lengthComputable){const passedTime=Date.now()-startTime;data.push({time:passedTime,loaded:evt.loaded,speed:8*evt.loaded/_mega/(passedTime/1e3)})}},!1),xhr}})}const _kilo=1024,_mega=1048576;let data=[];const _defaults={id:"upload",size:_mega,optimal:_mega},_thresholds=[{threshold:0,message:__("Low upload speed"),type:"error"},{threshold:33,message:__("Average upload speed"),type:"warning"},{threshold:66,message:__("Good upload speed"),type:"success"}],_messages=[{title:__("Upload speed"),status:__("Checking upload speed..."),uploadAvg:__("Average upload speed"),uploadMax:__("Max upload speed")}];return function uploadTester(config){const initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level);return{start(done){upload(parseInt(initConfig.size,10)).then(()=>{let totalSpeed=0,maxSpeed=0;_.forEach(data,val=>{totalSpeed+=val.speed,maxSpeed<val.speed&&(maxSpeed=_Mathround(100*val.speed)/100)});const avgSpeed=_Mathround(100*(totalSpeed/data.length))/100,results={max:maxSpeed,avg:avgSpeed,type:"upload"},status=this.getFeedback(avgSpeed),summary=this.getSummary(results);done(status,summary,results)})},get labels(){return labels},getSummary(results){return{uploadAvg:{message:labels.uploadAvg,value:`${results.avg} Mbps`},uploadMax:{message:labels.uploadMax,value:`${results.max} Mbps`}}},getFeedback(result){const optimal=initConfig.optimal/_mega,status=getStatus(100/optimal*result,_thresholds);return status.id=initConfig.id,status.title=labels.title,status}}}}),define("taoClientDiagnostic/tools/getPlatformInfo",["core/request","util/url","taoClientDiagnostic/tools/getConfig"],function(request,urlHelper,getConfig){"use strict";function getTesterUrl(win,action,controller,extension){const document=win.document,navigator=win.navigator,screen=win.screen,params={};let e=0,f=0;return params.ua=navigator.userAgent,e|=win.ActiveXObject?1:0,e|=win.opera?2:0,e|=win.chrome?4:0,e|="getBoxObjectFor"in document||"mozInnerScreenX"in win?8:0,e|="WebKitCSSMatrix"in win||"WebKitPoint"in win||"webkitStorageInfo"in win||"webkitURL"in win?16:0,e|=16&e&&-1==={}.toString.toString().indexOf("\n")?32:0,params.e=e,f|="sandbox"in document.createElement("iframe")?1:0,f|="WebSocket"in win?2:0,f|=win.Worker?4:0,f|=win.applicationCache?8:0,f|=win.history&&win.history.pushState?16:0,f|=document.documentElement.webkitRequestFullScreen?32:0,f|="FileReader"in win?64:0,params.f=f,params.r=Math.random().toString(36).substring(7),params.w=screen.width,params.h=screen.height,urlHelper.route(action,controller,extension,params)}const defaultConfig={browserVersionAction:"whichBrowser",browserVersionController:"CompatibilityChecker",browserVersionExtension:"taoClientDiagnostic"};return function getPlatformInfo(win,config){config=getConfig(config,defaultConfig);const url=getTesterUrl(win,config.browserVersionAction,config.browserVersionController,config.browserVersionExtension);return request({url,noToken:!0})}}),define("taoClientDiagnostic/tools/browser/tester",["jquery","lodash","i18n","util/url","core/logger","core/request","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/getPlatformInfo","taoClientDiagnostic/tools/getStatus"],function($,_,__,urlHelper,loggerFactory,request,getConfig,getLabels,getPlatformInfo,getStatus){"use strict";const logger=loggerFactory("taoClientDiagnostic/browser"),_defaults={id:"browser",browserVersionAction:"whichBrowser",browserVersionController:"CompatibilityChecker",browserVersionExtension:"taoClientDiagnostic",action:"check",controller:"DiagnosticChecker",browserslistUrl:"https://oat-sa.github.io/browserslist-app-tao/api.json"},_placeHolders={CURRENT_BROWSER:"%CURRENT_BROWSER%",CURRENT_OS:"%CURRENT_OS%"},_messages=[{title:__("Operating system and web browser"),status:__("Checking the browser..."),browser:__("Web browser"),os:__("Operating system")}],unknown=__("Unknown");return function browserTester(config){function checkBrowserSupport(platformInfo){const currentDevice=platformInfo.isMobile?"mobile":"desktop",currentOS=platformInfo.os.toLowerCase(),currentBrowser=platformInfo.browser.toLowerCase(),currentVersion=platformInfo.browserVersion;return fetchBrowserList().then(list=>list.some(entry=>{const{browser,device,os,versions}=entry;return!(currentDevice!==device)&&!(os&&os.toLowerCase()!==currentOS)&&!(browser.toLowerCase()!==currentBrowser)&&_(versions).map(version=>version.split("-")).flatten().value().some(version=>0<=currentVersion.localeCompare(version,void 0,{numeric:!0}))},{}))}const initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level),fetchBrowserList=()=>request({url:initConfig.browserslistUrl,noToken:!0}).catch(()=>[]);return{start(done){getPlatformInfo(window,initConfig).catch(err=>(logger.error(err),{browser:unknown,browserVersion:"",os:unknown,osVersion:"",isMobile:!1})).then(platformInfo=>checkBrowserSupport(platformInfo).then(browserSupported=>Object.assign(platformInfo,{browserSupported}))).then(platformInfo=>{request({url:urlHelper.route(initConfig.action,initConfig.controller,initConfig.extension),data:platformInfo,method:"POST",noToken:!0}).catch(()=>({success:!1,type:"error",message:__("Unable to validate the data as the server did not respond in time.")})).then(data=>{const percentage="success"===data.type?100:"warning"===data.type?33:0,status=this.getFeedback(percentage,data),summary=this.getSummary(platformInfo);status.customMsgRenderer=customMsg=>(customMsg||"").replace(_placeHolders.CURRENT_BROWSER,summary.browser.value).replace(_placeHolders.CURRENT_OS,summary.os.value),done(status,summary,platformInfo)})})},get labels(){return labels},getSummary(results){const currentBrowser=`${results.browser} ${results.browserVersion}`,currentOs=`${results.os} ${results.osVersion}`;return{browser:{message:labels.browser,value:currentBrowser},os:{message:labels.os,value:currentOs}}},getFeedback(result,data){const status=getStatus(result,data);return status.id=initConfig.id,status.title=labels.title,status}}}}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/main",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<p>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"header")||(null==depth0?depth0:lookupProperty(depth0,"header")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"header",hash:{},data:data,loc:{start:{line:6,column:25},end:{line:6,column:35}}}):helper))+"</p>"},3:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<p>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"info")||(null==depth0?depth0:lookupProperty(depth0,"info")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"info",hash:{},data:data,loc:{start:{line:7,column:23},end:{line:7,column:31}}}):helper))+"</p>"},5:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<p>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"setup")||(null==depth0?depth0:lookupProperty(depth0,"setup")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"setup",hash:{},data:data,loc:{start:{line:8,column:24},end:{line:8,column:33}}}):helper))+"</p>"},7:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"        <p>\n            <label for=\"school_id\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School ID:",{name:"__",hash:{},data:data,loc:{start:{line:11,column:35},end:{line:11,column:54}}}))+"</label>\n            <input type=\"text\" data-control=\"school_id\" id=\"school_id\" name=\"school_id\" maxlength=\"255\" placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School ID",{name:"__",hash:{},data:data,loc:{start:{line:12,column:117},end:{line:12,column:135}}}))+"\" />\n        </p>\n        <p>\n            <label for=\"workstation\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Workstation:",{name:"__",hash:{},data:data,loc:{start:{line:15,column:37},end:{line:15,column:58}}}))+"</label>\n            <input type=\"text\" data-control=\"workstation\" id=\"workstation\" name=\"workstation\" maxlength=\"64\" placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Workstation name",{name:"__",hash:{},data:data,loc:{start:{line:16,column:122},end:{line:16,column:147}}}))+"\" />\n        </p>\n"},9:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"validateSchoolName"),{name:"if",hash:{},fn:container.program(10,data,0),inverse:container.program(12,data,0),data:data,loc:{start:{line:20,column:12},end:{line:34,column:19}}}))?"":stack1},10:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"        <p>\n            <label for=\"school_number\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School number:",{name:"__",hash:{},data:data,loc:{start:{line:22,column:39},end:{line:22,column:62}}}))+"</label>\n            <input type=\"text\" data-control=\"school_number\" id=\"school_number\" name=\"school_number\" maxlength=\"10\" placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School number",{name:"__",hash:{},data:data,loc:{start:{line:23,column:128},end:{line:23,column:150}}}))+"\" />\n        </p>\n        <p>\n            <label for=\"school_pin\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School PIN:",{name:"__",hash:{},data:data,loc:{start:{line:26,column:36},end:{line:26,column:56}}}))+"</label>\n            <input type=\"text\" data-control=\"school_pin\" id=\"school_pin\" name=\"school_pin\" maxlength=\"4\" placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School PIN code (4 digits)",{name:"__",hash:{},data:data,loc:{start:{line:27,column:118},end:{line:27,column:153}}}))+"\" />\n        </p>\n"},12:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"        <p>\n            <label for=\"school_name\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School name:",{name:"__",hash:{},data:data,loc:{start:{line:31,column:37},end:{line:31,column:58}}}))+"</label>\n            <input type=\"text\" data-control=\"school_name\" id=\"school_name\" name=\"school_name\" maxlength=\"255\" placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"School name",{name:"__",hash:{},data:data,loc:{start:{line:32,column:123},end:{line:32,column:143}}}))+"\" />\n        </p>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"diagnostics-main-area\">\n\n    <h1>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:3,column:8},end:{line:3,column:17}}}):helper))+"</h1>\n\n    <div class=\"intro\">\n        "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"header"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:6,column:8},end:{line:6,column:46}}}))?"":stack1)+"\n        "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"info"),{name:"if",hash:{},fn:container.program(3,data,0),inverse:container.noop,data:data,loc:{start:{line:7,column:8},end:{line:7,column:42}}}))?"":stack1)+"\n        "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"setup"),{name:"if",hash:{},fn:container.program(5,data,0),inverse:container.noop,data:data,loc:{start:{line:8,column:8},end:{line:8,column:44}}}))?"":stack1)+"\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"requireSchoolId"),{name:"if",hash:{},fn:container.program(7,data,0),inverse:container.noop,data:data,loc:{start:{line:9,column:8},end:{line:18,column:15}}}))?"":stack1)+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"requireSchoolName"),{name:"if",hash:{},fn:container.program(9,data,0),inverse:container.noop,data:data,loc:{start:{line:19,column:8},end:{line:35,column:15}}}))?"":stack1)+"    </div>\n\n    <div class=\"clearfix\">\n        <button data-action=\"test-launcher\" class=\"btn-info small rgt\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"button")||(null==depth0?depth0:lookupProperty(depth0,"button")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"button",hash:{},data:data,loc:{start:{line:39,column:71},end:{line:39,column:81}}}):helper))+"</button>\n    </div>\n\n    <ul class=\"plain results\"></ul>\n\n    <div class=\"status\">\n        <h2></h2>\n    </div>\n\n</div>"},useData:!0})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/result",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"    <div class=\"clearfix\">\n        <button data-action=\"show-details\" class=\"rgt btn-info small\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Show Details",{name:"__",hash:{},data:data,loc:{start:{line:7,column:70},end:{line:7,column:91}}}))+"</button>\n        <button data-action=\"hide-details\" class=\"rgt btn-info small hidden\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Hide Details",{name:"__",hash:{},data:data,loc:{start:{line:8,column:77},end:{line:8,column:98}}}))+"</button>\n        <div class=\"details hidden\"></div>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<li data-result=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:1,column:17},end:{line:1,column:23}}}):helper))+"\">\n    <h2>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:2,column:8},end:{line:2,column:17}}}):helper))+"</h2>\n    <div class=\"result\"></div>\n\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"details"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:5,column:4},end:{line:11,column:11}}}))?"":stack1)+"</li>"},useData:!0})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/details",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"                <tr><td>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"message")||(null==depth0?depth0:lookupProperty(depth0,"message")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"message",hash:{},data:data,loc:{start:{line:7,column:24},end:{line:7,column:35}}}):helper))+"</td><td>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"value")||(null==depth0?depth0:lookupProperty(depth0,"value")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"value",hash:{},data:data,loc:{start:{line:7,column:44},end:{line:7,column:53}}}):helper))+"</td></tr>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"details\">\n    <h2>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Details",{name:"__",hash:{},data:data,loc:{start:{line:2,column:8},end:{line:2,column:24}}}))+"</h2>\n    <div>\n        <table class=\"matrix\">\n            <tbody>\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:6,column:12},end:{line:8,column:21}}}))?"":stack1)+"            </tbody>\n        </table>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/feedback",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"legend\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"legend")||(null==depth0?depth0:lookupProperty(depth0,"legend")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"legend",hash:{},data:data,loc:{start:{line:4,column:38},end:{line:4,column:48}}}):helper))+"</div>"},3:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"customMsg\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"customMsg")||(null==depth0?depth0:lookupProperty(depth0,"customMsg")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"customMsg",hash:{},data:data,loc:{start:{line:5,column:44},end:{line:5,column:57}}}):helper))+"</div>"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"small feedback feedback-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"type")||(null==depth0?depth0:lookupProperty(depth0,"type")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"type",hash:{},data:data,loc:{start:{line:1,column:36},end:{line:1,column:44}}}):helper))+"\">\n    <span class=\"icon icon-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"type")||(null==depth0?depth0:lookupProperty(depth0,"type")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"type",hash:{},data:data,loc:{start:{line:2,column:27},end:{line:2,column:35}}}):helper))+"\"></span>\n    <span class=\"msg\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"message")||(null==depth0?depth0:lookupProperty(depth0,"message")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"message",hash:{},data:data,loc:{start:{line:3,column:22},end:{line:3,column:33}}}):helper))+"</span>\n    "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"legend"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:4,column:4},end:{line:4,column:61}}}))?"":stack1)+"\n    "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"customMsg"),{name:"if",hash:{},fn:container.program(3,data,0),inverse:container.noop,data:data,loc:{start:{line:5,column:4},end:{line:5,column:70}}}))?"":stack1)+"\n</div>"},useData:!0})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/quality-bar",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){return" wide"},3:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:2,column:79},end:{line:2,column:88}}}):helper))+"\""},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"quality-bar\">\n    <div class=\"quality-indicator"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"wide"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:33},end:{line:2,column:57}}}))?"":stack1)+"\""+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"label"),{name:"if",hash:{},fn:container.program(3,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:58},end:{line:2,column:96}}}))?"":stack1)+"></div>\n</div>"},useData:!0})}),define("css!taoClientDiagnosticCss/diagnostics",[],function(){}),define("taoClientDiagnostic/tools/diagnostic/diagnostic",["jquery","lodash","i18n","async","ui/component","core/logger","core/store","core/request","core/dataProvider/request","ui/dialog/alert","ui/feedback","util/url","taoClientDiagnostic/tools/performances/tester","taoClientDiagnostic/tools/bandwidth/tester","taoClientDiagnostic/tools/upload/tester","taoClientDiagnostic/tools/browser/tester","taoClientDiagnostic/tools/getStatus","taoClientDiagnostic/tools/getConfig","tpl!taoClientDiagnostic/tools/diagnostic/tpl/main","tpl!taoClientDiagnostic/tools/diagnostic/tpl/result","tpl!taoClientDiagnostic/tools/diagnostic/tpl/details","tpl!taoClientDiagnostic/tools/diagnostic/tpl/feedback","tpl!taoClientDiagnostic/tools/diagnostic/tpl/quality-bar","css!taoClientDiagnosticCss/diagnostics"],function($,_,__,async,component,loggerFactory,store,request,requestData,dialogAlert,feedback,urlHelper,performancesTester,bandwidthTester,uploadTester,browserTester,getStatus,getConfig,mainTpl,resultTpl,detailsTpl,feedbackTpl,qualityBarTpl){"use strict";const logger=loggerFactory("taoClientDiagnostic/diagnostic"),_defaults={title:__("System Compatibility"),header:__("This tool will run a number of tests in order to establish how well your current environment is suitable to run the TAO platform."),info:__("Be aware that these tests will take up to several minutes."),button:__("Test system compatibility"),actionStore:"storeData",actionSchool:"schoolName",controller:"DiagnosticChecker",extension:"taoClientDiagnostic",actionDropId:"deleteId",storeAllRuns:!1,configurableText:{}},_thresholds=[{threshold:0,message:__("Your system requires a compatibility update, please contact your system administrator."),type:"error"},{threshold:33,message:__("Your system is not optimal, please contact your system administrator."),type:"warning"},{threshold:66,message:__("Your system is fully compliant."),type:"success"}],diagnostic={changeStatus(status){return this.is("rendered")&&this.controls.$status.html(status),this},store(type,data,done){const config=this.config,url=urlHelper.route(config.actionStore,config.controller,config.extension,config.storeParams);data=_.omit(data,"values"),data.type=type,request({url,data,method:"POST",noToken:!0}).then(done).catch(err=>{logger.error(err),feedback().error(__("Unable to save the results! Please check your connection.")),done()})},getCustomMsg(key){return this.config.configurableText[key]},addCustomFeedbackMsg(status,msg){this.hasFailed(status)&&msg&&(_.isFunction(status.customMsgRenderer)&&(msg=status.customMsgRenderer(msg)),status.feedback=status.feedback||{},status.feedback.customMsg=msg)},hasFailed(result){return!(result&&result.feedback&&"success"===result.feedback.type)},addResult(result){if(this.is("rendered")){result.quality&&result.quality.label&&2<result.quality.label.toString().length&&(result.quality.wide=!0);const $main=$(resultTpl(result)),$result=$main.find(".result");result.feedback&&$result.append($(feedbackTpl(result.feedback))),result.quality&&$result.append($(qualityBarTpl(result.quality))),result.details&&$main.find(".details").append($(detailsTpl(result.details)));const $indicator=$main.find(".quality-indicator");this.controls.$results.append($main),$main.fadeIn(()=>{$indicator.length&&$indicator.animate({left:result.percentage*$main.outerWidth()/100-$indicator.outerWidth()/2})})}return this},cleanUp(){return this.controls.$results.empty(),this},enable(){return this.controls.$start.removeClass("hidden"),this},disable(){return this.controls.$start.addClass("hidden"),this},prepare(){return this.trigger("start"),this.changeStatus(__("Starting...")),this.setState("running",!0),this.setState("done",!1),this.cleanUp(),this.disable(),this},finish(){const config=this.config;return this.enable(),config.storeAllRuns&&this.deleteIdentifier(),this.trigger("end"),this.changeStatus(__("Done!")),this.setState("running",!1),this.setState("done",!0),this},deleteIdentifier(){const url=urlHelper.route(this.config.actionDropId,this.config.controller,this.config.extension);return request({url,method:"POST",noToken:!0})},run(){const information=[],scores={},testers=[],customInput=this.getCustomInput(),doRun=()=>{const doCheck=(testerConfig,cb)=>{const testerId=testerConfig.id;this.trigger("starttester",testerId),this.setState(testerId,!0);const processTester=testerFactory=>{const tester=testerFactory(getConfig(testerConfig,this.config),this);this.changeStatus(tester.labels.status),tester.start((status,details,results)=>{if(testerConfig.customMsgKey){const customMsg=this.getCustomMsg(testerConfig.customMsgKey);this.addCustomFeedbackMsg(status,customMsg)}_.forEach(details,info=>information.push(info)),scores[status.id]=status,this.trigger("endtester",testerId,status),this.setState(testerId,!1),results=_.mapValues(results,value=>{switch(typeof value){case"boolean":return value?1:0;case"object":return JSON.stringify(value)}return value}),this.store(testerId,results,()=>{this.addResult(status),cb()})})},processFailure=err=>{logger.error(err),feedback().error(__("Unable to process with the diagnostic tester %s. The tester module is unreachable.",testerId)),cb()};require([testerConfig.tester],processTester,processFailure)};this.is("rendered")&&(this.prepare(),_.forEach(this.config.testers,(testerConfig,testerId)=>{testerConfig.id=testerConfig.id||testerId,testerConfig.enabled&&testers.push(cb=>doCheck(testerConfig,cb))}),async.series(testers,()=>{const total=_.min(scores,"globalPercentage"),status=getStatus(total.globalPercentage,_thresholds);status.title=__("Total"),status.id="total",this.addCustomFeedbackMsg(status,this.config.configurableText.diagTotalCheckResult),status.details=information,this.addResult(status),this.finish()}))};return 0<_.size(customInput)?this.store("custom_input",customInput,doRun):doRun(),this},getCustomInput(){const vars={};return window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,(m,key,value)=>{_.has(this.config.customInput,key)&&(vars[key]="undefined"==typeof value?"":value)}),vars}};return function diagnosticFactory(container,config){config&&_.forEach(["title","header","footer","info","button"],name=>{config[name]&&(config[name]=__(config[name]))});const diagComponent=component(diagnostic,_defaults).setTemplate(mainTpl).on("destroy",function onDiagnosticDestroy(){this.controls=null}).on("init",function onDiagnosticInit(){this.render(container)}).on("render",function onDiagnosticRender(){function getInputValue(name){const $control=getControl(name);return($control&&$control.val()||"").trim()}function setInputValue(name,value){const $control=getControl(name);$control&&$control.val(value)}function toggleControl(name,state){const $control=getControl(name);$control&&("undefined"==typeof state&&(state=!$control.is(":enabled")),state?$control.prop("disabled",!1):$control.prop("disabled",!0))}const runDiagnostics=data=>{data&&_.isPlainObject(data)&&(this.config.storeParams=_.assign(this.config.storeParams||{},data)),this.run()};let launch=()=>runDiagnostics();const getControl=name=>this.controls[`\$${name}`],requestSchoolName=values=>{const componentConfig=this.config;return requestData(urlHelper.route(componentConfig.actionSchool,componentConfig.controller,componentConfig.extension),values,"POST").then(data=>({school_name:data,school_number:values.school_number}))},manageSchoolProperties=(fields,validate)=>{function toggleStart(){const allow=_.every(fields,getInputValue);return toggleControl("start",allow),allow}function toggleFields(state){_.forEach(fields,function(fieldName){toggleControl(fieldName,state)})}_.forEach(fields,fieldName=>{this.controls[`\$${fieldName}`]=this.getElement().find(`[data-control="${fieldName}"]`).on("keypress",e=>{const shouldStart=13===e.which;shouldStart&&e.preventDefault(),_.defer(()=>{toggleStart()&&shouldStart&&this.controls.$start.click()})})}),toggleStart(),toggleFields(!1),store("client-diagnostic").then(storage=>(this.on("start.school",()=>{_.forEach(fields,fieldName=>{storage.setItem(fieldName,getInputValue(fieldName)).catch(error=>{logger.error(error)})})}),Promise.all(_.map(fields,fieldName=>storage.getItem(fieldName).then(value=>{setInputValue(fieldName,value)}))))).catch(error=>{logger.error(error)}).then(()=>{toggleFields(!0),toggleStart()}),launch=()=>{const values=_.reduce(fields,(result,fieldName)=>(result[fieldName]=getInputValue(fieldName),result),{});this.changeStatus(__("Getting school name...")).cleanUp().disable(),_.isFunction(validate)?validate(values).then(runDiagnostics).catch(error=>{const response=error.response||{},message=response.errorMsg||response.errorMessage||__("An error occurred! Please verify your input!");dialogAlert(message),logger.error(error),this.changeStatus(__("Failed to get school name")).enable()}):runDiagnostics(values)},this.on("start.school",()=>{toggleFields(!1)}).on("end.school",()=>{toggleFields(!0)})};this.controls={$start:this.$component.find("[data-action=\"test-launcher\"]"),$status:this.$component.find(".status h2"),$results:this.$component.find(".results")},this.controls.$start.on("click",()=>{this.controls.$start.is(":enabled")&&launch()}),this.config.requireSchoolName&&(this.config.validateSchoolName?manageSchoolProperties(["school_number","school_pin"],requestSchoolName):manageSchoolProperties(["school_name"])),this.config.requireSchoolId&&manageSchoolProperties(["school_id","workstation"]),this.controls.$results.on("click","button[data-action=\"show-details\"]",function onShowDetails(){const $btn=$(this).closest("button"),$result=$btn.closest("[data-result]"),$details=$result.find(".details");$details.removeClass("hidden"),$btn.addClass("hidden"),$result.find("[data-action=\"hide-details\"]").removeClass("hidden")}),this.controls.$results.on("click","button[data-action=\"hide-details\"]",function onHideDetails(){const $btn=$(this).closest("button"),$result=$btn.closest("[data-result]"),$details=$result.find(".details");$details.addClass("hidden"),$btn.addClass("hidden"),$result.find("[data-action=\"show-details\"]").removeClass("hidden")})});return _.defer(()=>diagComponent.init(config)),diagComponent}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}(".diagnostics-content-area{max-width:768px;margin:40px auto 40px auto}.diagnostics-main-area{margin:40px auto 0 auto;background:#f3f1ef;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;padding:20px}.diagnostics-main-area h1,.diagnostics-main-area h2,.diagnostics-main-area h3{font-style:normal;font-family:\"Source Sans Pro\",sans-serif}.diagnostics-main-area h1{margin-bottom:20px;font-size:20px;font-size:2rem}.diagnostics-main-area h2{margin:0;font-size:14px;font-size:1.4rem}.diagnostics-main-area h3{margin-top:10px;margin-bottom:5px;font-size:12px;font-size:1.2rem}.diagnostics-main-area .status h2,.diagnostics-main-area .details h2{margin:1rem 0}.diagnostics-main-area .legend{font-style:italic;font-weight:normal;font-family:\"Source Sans Pro\",sans-serif;font-size:11px;font-size:1.1rem}.diagnostics-main-area .customMsg{margin-top:10px}.diagnostics-main-area .quality-bar{height:15px;background:linear-gradient(to right, #CE1431 0%, #D57915 25%, #D5A215 50%, #D5CB15 75%, #36B111 100%);opacity:.8;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;margin:5px 0 10px;position:relative}.diagnostics-main-area .quality-indicator{position:absolute;border-width:10px 8px;border-style:solid;border-color:#333 rgba(0,0,0,0) rgba(0,0,0,0);top:-1px;height:25px;width:0}.diagnostics-main-area .quality-indicator[title]:before{font-size:11px;font-size:1.1rem;content:attr(title);position:absolute;top:-36px;left:-12px;text-align:center;width:24px;height:24px;line-height:24px;display:inline-block;background-color:#0e5d91;color:rgba(255,255,255,.9);-moz-border-radius:12px;-webkit-border-radius:12px;border-radius:12px}.diagnostics-main-area .quality-indicator.wide[title]:before{left:-16px;width:32px}.diagnostics-main-area [data-result],.diagnostics-main-area .bandwidth-box{display:none}.diagnostics-main-area [data-action=bandwidth-launcher]{margin:5px 0 10px}.diagnostics-main-area li{padding-bottom:10px}.diagnostics-main-area .intro{margin-bottom:20px}.diagnostics-main-area .intro label{display:inline-block;width:150px}table.datatable [class^=icon-]{padding:0}table.datatable td{font-size:90%;font-weight:normal}table.datatable .progress .state:not(:first-child):before{content:\" - \"}table.datatable .progress .item-time:before{content:\" (\"}table.datatable .progress .item-time .total:before{content:\" / \"}table.datatable .progress .item-time:after{content:\")\"}.details table.matrix{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;margin-top:5px}.details table.matrix td:first-child{min-width:30%}.diagnostic-scope h1{font-family:\"Source Sans Pro\",sans-serif;font-size:22px;font-size:2.2rem;font-weight:normal}.diagnostic-scope h2{font-family:\"Source Sans Pro\",sans-serif;font-size:18px;font-size:1.8rem;margin:30px 0 10px}.diagnostic-scope form.daterange label{padding:0}.diagnostic-scope form.daterange input{margin:0 10px}.diagnostic-scope table.datatable [class^=icon-]{padding:0}.diagnostic-scope table.datatable td{font-size:90%;font-weight:normal}.diagnostic-scope .content{margin:auto}.diagnostic-scope .diagnostic-index .content,.diagnostic-scope .diagnostic-runner .content{width:100%}.diagnostic-scope .diagnostic-index .message,.diagnostic-scope .diagnostic-runner .message{padding:8px;text-align:center}.diagnostic-scope .panel .action-bar{background:#266d9c;padding:3px;overflow:hidden;color:#e7eff4}.diagnostic-scope .panel .action-bar .btn-info{overflow:hidden;background:rgba(0,0,0,0);border:1px rgba(255,255,255,.3) solid}.diagnostic-scope .diagnostics-main-area{margin-top:0px;max-width:800px}.diagnostic-scope .detailed-value{display:flex;justify-content:space-between}.diagnostic-scope .detailed-value.errors{color:#d8ae5b}.diagnostic-scope .detailed-value .details{font-size:2rem;cursor:pointer;color:#3e7da7}.diagnostic-scope .detailed-value .details:hover{color:#03131d}.action-bar .tool-exitButton,.action-bar [data-control=exitButton]{float:right}\n\n/*# sourceMappingURL=../../../taoClientDiagnostic/views/css/diagnostics.css.map */"),define("taoClientDiagnostic/loader/diagnostic.bundle",function(){}),window.bundles=(window.bundles||[]).concat(["taoQtiItem/loader/taoQtiItem.min","taoItems/loader/taoItems.min"]);
//# sourceMappingURL=diagnostic.min.js.map